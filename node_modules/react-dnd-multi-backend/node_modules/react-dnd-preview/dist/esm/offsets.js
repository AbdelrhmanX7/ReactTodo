// Reminder:
// getInitialClientOffset: clientX/clientY when drag started
// getInitialSourceClientOffset: parent top/left bounding box when drag started
// getClientOffset: current clientX/clientY
// getSourceClientOffset: difference between parent top/left and current clientX/clientY
//  = (getClientOffset + getInitialSourceClientOffset) - getInitialClientOffset
// getDifferenceFromInitialOffset: difference between clientX/clientY when drag started and current one
var subtract = function subtract(a, b) {
  return {
    x: a.x - b.x,
    y: a.y - b.y
  };
};

var calculateParentOffset = function calculateParentOffset(monitor) {
  var client = monitor.getInitialClientOffset();
  var source = monitor.getInitialSourceClientOffset(); // TODO: why is client containing `undefined` values _sometimes_?
  // more precisely, just after MultiBackend switched from HTML5 to Touch _for the first time_?

  if (client === null || source === null || client.x === undefined || client.y === undefined) {
    return {
      x: 0,
      y: 0
    };
  }

  return subtract(client, source);
};

export var calculatePointerPosition = function calculatePointerPosition(monitor, childRef) {
  var offset = monitor.getClientOffset();

  if (offset === null) {
    return null;
  } // If we don't have a reference to a valid child, use the default offset:
  // current cursor - initial parent/drag source offset


  if (!childRef.current || !childRef.current.getBoundingClientRect) {
    return subtract(offset, calculateParentOffset(monitor));
  }

  var bb = childRef.current.getBoundingClientRect();
  var middle = {
    x: bb.width / 2,
    y: bb.height / 2
  };
  return subtract(offset, middle);
};